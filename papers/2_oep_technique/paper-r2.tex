\input{header.tex}
\begin{document}
\preprint{AIP/123-OEP}

\title{Ab Initio Effective One-Electron Potential Operators:
Applications for Charge-Transfer Energy in Effective Fragment Potentials}

\author{Bartosz B{\l}asiak}
\email[]{blasiak.bartosz@gmail.com}
\homepage[]{https://www.polonez.pwr.edu.pl}

\author{Marta Cho{\l}uj} 
\author{Joanna D. Bednarska}
\author{Wojciech Bartkowiak}

\affiliation{Department of Physical and Quantum Chemistry, Faculty of Chemistry, 
Wroc{\l}aw University of Science and Technology, 
Wybrze{\.z}e Wyspia{\'n}skiego 27, Wroc{\l}aw 50-370, Poland}

\date{\today}

\begin{abstract}
The concept of the effective one-electron potentials has been useful for many decades
in efficient description of electronic structure of chemical systems, especially extended
molecular aggregates such as interacting molecules in condensed phases.
\end{abstract}

\pacs{}

\maketitle

\tableofcontents

\section{\label{s:1.introduction}Introduction}

Charge transfer (CT) between molecules occurs when the net electronic populations 
of interacting molecules change which leads to an additional stabilization 
of a molecular aggregate.\cite{Otto.Ladik.IJQC.1980,Stone.TheTheoryOfIntermolecularForces.1996}
Although CT processes can be relatively easily scrutinized based
on the total amount of charge transferred between interacting species,\cite{Otto.Ladik.IJQC.1980}
evaluation of its contribution to the intermolecular interaction
potential\cite{Stone.TheTheoryOfIntermolecularForces.1996} is far from trivial due to 
its very complex quantum mechanical (QM) origins even at the Hartree\hyp{}Fock approximation level,\cite{Otto.Ladik.ChemPhys.1975}
and cannot be realized in terms of any classical nor semi\hyp{}classical approach.
In fact, CT does not naturally emerge in the symmetry 
adapted perturbation theory\cite{Jeziorski.Moszynski.Szalewicz.ChemRev.1994} (SAPT)
due to certain technical aspects related with the use of finite basis set expansions
in modern quantum chemistry calculations and minimizing the basis set superimposition error (BSSE). 
Recently, Stone and Misquitta showed that CT energy
can be extracted from SAPT calculations by comparing the induction energies
of fictional systems in which basis functions are centered either on the monomers only, or the entire 
interacting complex.\cite{Stone.Misquitta.CPL.2009}
CT energy was formulated by Murrell et al.~\cite{Murrell.Randic.Williams.Longuet-Higgins.ProcRSocLondA.1965} 
in their perturbation theory in the region of small wavefunction overlap up to second order.
However, their theory is also computationally too expensive to apply for efficient
calculation of intermolecular forces in molecular dynamics because
it involces instantaneous calculations of the electron repulsion integrals (ERI's)
in molecular orbital (MO) basis.\cite{Otto.Ladik.ChemPhys.1975}

The apparent difficulty in theoretically characterising the CT energy
in terms of the interacting molecular fragments
is indeed a challenge in developing modern force fields 
or \emph{ab initio} fragmentation methods\cite{Gordon.Fedorov.Pruitt.Slipchenko.ChemRev.2012}
for modeling structure
and dynamics in condensed phases.
This needs to be contrasted with the
Coulombic electrostatics,
non\hyp{}Coulombic repulsion (i.e., due to Pauli exclusion principle), 
dispersion and induction for instance, 
which to a certain extent
can be well described by, respectively, 
the multipole moments of charge density distributions,\cite{Sokalski.Poirier.CPL.1983,
Etchebest.Lavery.Pullman.TheorChimActa.1982,Stone.JCTC.2005}
the van der Waals repulsive and attractive potentials, 
as well as the polarizability models, i.e., all being relatively simple and computationally
inexpensive to evaluate mathematical models. 
Due to this reason, the
CT effects 
%while usually of significant and non\hyp{}negligible magnitude as compared 
%to the total interaction energy, 
are not included in any molecular mechanics force field developed up to date
such as OPLS, Amber, CHARMM, Gromos or even polarizale AMOEBA force field. 
The only way to
incorporate the CT effects in the condensed\hyp{}phase simulations,
apart from performing full QM molecular dynamics simulations,
is through the second generation of the effective fragment potential 
(EFP2) method,\cite{Gordon.Smith.Xu.Slipchenko.AnnuRevPhysChem.2013,
   Nguyen.Pachter.Day.JCP.2014,
   Day.Jensen.Gordon.Webb.Stevens.Krauss.Garmer.Basch.Cohen.JCP.1996}
developed by Gordon group.\cite{Li.Gordon.Jensen.JCP.2006,Xu.Gordon.JCP.2013}
EFP2 is an \emph{ab initio} force field
derived on the grounds of the first\hyp{}principles perturbation theory
at the HF level and including the intermolecular dispersion effects
by the response theory based on the imaginary frequency\hyp{}dependent dipole\hyp{}dipole polarizabilities.
That is to say, the total intermolecular 
interaction potential is approximated as 
%
\begin{equation}\label{e:u-efp2}
 U^{\rm EFP2} \approx U^{\rm Coul} + U^{\rm Ex-Rep} + U^{\rm Ind} + U^{\rm Disp} + U^{\rm CT} \;.
\end{equation}
%
where $U^{\rm Coul}$ is the Coulombic interaction energy of the unperturbed charge\hyp{}density
distributions of the monomers, approximated by the distributed multipole approximation,
$U^{\rm Ex-Rep}$ is the exchange\hyp{}repulsion energy originating from the Pauli exclusion
principle, that could be roughly understood as the Heitler\hyp{}London interaction
energy with $U^{\rm Coul}$ subtracted, $U^{\rm Ind}$ and $U^{\rm Disp}$
are the induction and dispersion energies obtained from the distributed polarizability
approximation, and finally $U^{\rm CT}$ is the CT energy, the focus of this work.

Despite the considerable success of the EFP2 theory
in accurately modeling the extended molecular systems 
like solutions and recently even biomolecules
with the level of accuracy
roughly arguably comparable to the M{\o}ller\hyp{}Plesset perturbation theory,
evaluation of the CT energy in EFP2 model is still too costly for
typical uses in the
molecular dynamics simulations. It has been reported that 
the implementation of the EFP2 CT energy component in GAMESS
is on average 3-10 times more demanding than the exchange\hyp{}repulsion
component, becoming a bottleneck of evaluation of total interaction 
energy and gradients.\cite{Gordon.Smith.Xu.Slipchenko.AnnuRevPhysChem.2013,
Li.Gordon.Jensen.JCP.2006}
In effect, the CT energy component is usually ignored in most of the applications. In the 
recent LIBEFP library, CT term were not implemented in the official release 
of the code.\cite{Kaliman.Slipchenko.JCC.2015}

%However, calculating the CT stabilization energy is usually much more expensive 
%than evaluating the contributions due to other effects.
%However, the computational cost of the CT term is usually at least few times larger
%than the next costly contribution $U^{\rm Ex-Rep}$, which is still too costly
%to perform molecular dynamics (MD) simulations including the $U^{\rm CT}$. 

The effect of CT on the interaction energy 
is known to be often non\hyp{}negligible, especially
in donor\hyp{}acceptor systems such as H\hyp{}bonded species
and charged complexes, although highly depends on the theoretical
approach being used. 
The approach adopted by the founders of EFP2 model
is based on
%The most common methodology,
%adopted also by the founders of EFP2 model,
%is 
the approximation to SAPT at HF level of theory 
which is based on the isolated monomeric wave functons
as references (here abbreviated to CT/HF0).
In this formulation, the CT energy can be understood
as a part of the polarization energy that cannot be
linked to dispersion and pure induction interactions. 
In this definition of CT, mixing of virtual and occupied MO's
technically belonging to different unperturbed wavefunction occurs,
unlike the pure induction and dispersion, in which such mixings are contained
solely within one monomer.
%This level of definition of the CT energy will be referred here as to
%the IPTO-CT energy. 
%For defining the CT/HF0, 
%most common reference is the HF approximation
%most certainly because the HF energy functional is known
%and its properties are well understood.
%In the EFP2 model, the total interaction energy is approximated as
%a sum of five contributions due to the Coulombic interaction of the unperturbed (isolated)
%charge densities of the monomers, exchange\hyp{}repulsion energy,
%induction energy due to mutual polarization, intermolecular dispersion energy,
%as well as the CT energy.
%For developing the efficient 
%\emph{ab initio} fragmentation method 
%
% the second generation of the effective fragment potential method (EFP2),
%the Hartree\hyp{}Fock (HF) model or the density functional theory (DFT) were
%employed as starting points 
%Modelling the structure and dynamics of extended molecular aggregates, such as
%liquids and solutions require
%EFP2 relies on the intermolecular 
%perturbation theory, and the total interaction energy is approximated as ...
%
%\begin{equation}
% U^{\rm EFP2} \approx U^{\rm Coul} + U^{\rm Ex-Rep} + U^{\rm Ind} + U^{\rm Disp} + U^{\rm CT} \;.
%\end{equation}
%%

One of the main goals of this work, apart from developing
more efficient model of the CT/HF0 energy, is to
extend the effective one\hyp{}electron potentials (here referred to as the OEP) 
technique
used previously\cite{
Otto.Ladik.ChemPhys.1975,
Holas.March.PhysRevA.1991,
Weber.Thiel.TCA.2000,
Neese.JCP.2005,
Cisneros.Andres.Piquemal.Darden.JCP.2005,
Piquemal.Cisneros.Reinhardt.Gresh.Darden.JCP.2006,
Li.Gordon.Jensen.JCP.2006,
Blasiak.Lee.Cho.JCP.2013,
Blasiak.Maj.Cho.Gora.JCTC.2015}
to simplify the rigorous and costly quantum chemistry models of extended systems
with a particular emphasis on solvation phenomena and molecular dynamics.
The presented OEP technique of removing ERI's from the working
equations
follows the notion of the importance of 
one\hyp{}electron densities in chemistry\cite{Holas.March.PhysRevA.1991},
thus reducing the complicated summations involving ERI's to much shorter expressions involving
only one\hyp{}electron integrals.
Therefore, the OEP computational method is first presented in Section~II.
Next, in Section III,
the new technique is used to derive an alternative formulation of the CT/HF0 energy
compatible with the EFP2 method. Subsequently, after details of computations
are discussed in Section IV, in Section V the validation of the 
OEP\hyp{}based CT/HF0 model is presented and its performance in terms 
of accuracy and computational speed is compared against the EFP2
model. Finally, few concluding remarks and comments for future work
are given in Section VI.
%ERI's, which are oftentimes the main bottleneck
%in simulating large systems, will be projected out from the working equations
%to ultimately form the effective fragments in a form of small matrices that are much easier to handle.
%The proposed methodology aims in removing ERI's from the working equations
%to ultimately form the effective fragments that are much easier to handle.
%
%It is believed that the proposed concept can be helpful in designing future methods tuned 
%for studying electronically excited states in solutions, better describing molecular
%dynamics as well as enabling the vibrational analysis of extended systems
%In this work, we propose an alternative formulation of the CT energy compatible with the
%EFP2 method. We start from the perturbation theory of Murrell et al.
%and
%introduce the effective one\hyp{}electron potential (OEP) operators
%to eliminate the electron\hyp{}repulsion integrals (ERI's) from the original theory.
%Later we validate the model against the EFP2 method in Section XXX. Finally,
%we conclude this work and provide few remarks on future development in Section XXX.

\section{\label{s:2.oep}Effective One-Electron Potential Operators}

To establish the notation within the present work, 
the formalism of one\hyp{}electron potential (OEP) operators is
given first.
The one\hyp{}electron Coulomb static effective potential $v^{\rm eff}({\bf r})$
produced by a certain effective one\hyp{}electron charge density distribution $\rho^{\rm eff}({\bf r})$
is 
%
\begin{equation} \label{e:v-eff}
	v^{\rm eff}({\bf r}) = \int \frac{ \rho^{\rm eff}({\bf r}') }{ \vert {\bf r}' - {\bf r} \vert} d{\bf r}' \;,
\end{equation}
%
where ${\bf r}$ is a spatial coordinate. 
For convenience, the total effective density can be split into nuclear and electronic contributions,
%
\begin{equation} \label{e:rho-eff}
 \rho^{\rm eff}({\bf r}) = \lambda \rho^{\rm eff}_{\rm nuc}({\bf r}) + \rho^{\rm eff}_{\rm el}({\bf r}) \;,
\end{equation}
%
where $\lambda$ is a certain parameter and is assumed either 1 or 0 in this work.
Formally, the electronic part can be expanded in terms of an effective
bond order matrix represented in a certain basis of orbitals, $\BM{\phi}({\bf r})$,
%
\begin{equation} \label{e:d-spectral}
	\rho^{\rm eff}_{\rm el}({\bf r}) = \sum_{\alpha\beta} P_{\alpha\beta}^{\rm eff} 
	\phi_\alpha({\bf r}) \phi_\beta^{*}({\bf r})  \;.
\end{equation}
%
Based on that, the operator form of the effective potential 
can be written as
%
\begin{equation} \label{e:oep-operator}
	\hat{v}^{\rm eff} = 
        \lambda \hat{v}_{\rm nuc} +
        %\sum_{\alpha\beta} 
	%\Ket{\alpha} 
        \int d{\bf r} \Ket{{\bf r}} 
        v^{\rm eff}({\bf r})
	%\left[
	%\int
	%\hat{J}^{\rm}_{\alpha\beta}({\bf r}') 
	%\rho^{\rm eff}({\bf r}')
	%d{\bf r}' 
	%\right]
	%\Bra{\beta}  
        \Bra{{\bf r}}
\end{equation}
%
with the nuclear
%and Coulomb operators 
operator
defined by
%
%\begin{subequations}
%\begin{align}
\begin{equation} \label{e:oep-operator-nuc}
        \hat{v}_{\rm nuc} \equiv \sum_x^{\rm At}  
                     \int d{\bf r} \Ket{{\bf r}} 
                     \frac{Z_x}{\vert {\bf r} - {\bf r}_x \vert}
                     \Bra{{\bf r}} \;.
	%\hat{J}^{\rm}_{\alpha\beta}({\bf r}) f({\bf r}) &\equiv
	%f({\bf r}) 
	%\int
	%\frac{ \phi_\alpha^{*}({\bf r}') \phi_\beta({\bf r}') }{ \vert {\bf r}' - {\bf r} \vert} d{\bf r}'
\end{equation}
%\end{align}
%\end{subequations}
%
%for any one\hyp{}electron function $f({\bf r})$. 
and $\BraKet{\bf r}{\alpha} = \varphi_\alpha({\bf r})$.
The matrix element of the effective potential operator
is therefore given by
%
\begin{equation} \label{e:oep-matrix-element}
	\tBraKet{\alpha}{ \hat{v}^{\rm eff} }{\beta}
	= \lambda \sum_x^{\rm At} W_{\alpha\beta}^{(x)} +
        \sum_{\gamma\delta} \BraKet{\alpha\beta}{\gamma\delta} P^{\rm eff}_{\gamma\delta}  \;,
\end{equation}
%
where 
%
\begin{equation} \label{e:oep-matrix-element-nuc}
 W_{\alpha\beta}^{(x)} = 
 Z_x \int \frac{\phi^*_\alpha({\bf r}) \phi_\beta({\bf r})}{\vert {\bf r} - {\bf r}_x \vert} d{\bf r} \;,
\end{equation}
%
$Z_x$ is the atomic number of the $x$th atom,
and the symbol `At' denotes all atoms that contribute to the effective potential.
In the above equation and throughout the work, 
%
\begin{equation} \label{e:1el-operator}
\tBraKet{\alpha}{\mathscr{O}(1)}{\beta} \equiv \int \phi^*_\alpha({\bf r}) \mathscr{O}(1) \phi_\beta({\bf r}) d{\bf r} 
\end{equation}
%
for any one\hyp{}electron operator $\mathscr{O}(1)$ 
and the electron repulsion integral (ERI)
is defined according to
%
\begin{equation} \label{e:eri}
	\BraKet{\alpha\beta}{\gamma\delta} \equiv
	\iint 
	\frac{ \phi_\alpha^{*}({\bf r}_1) \phi_\beta({\bf r}_1) 
	       \phi_\gamma^{*}({\bf r}_2) \phi_\delta({\bf r}_2) }{ \vert {\bf r}_1 - {\bf r}_2 \vert}
	d{\bf r}_1 d{\bf r}_2  \;.
\end{equation}
%

\subsection{\label{ss:2.1.oep-technique}Incorporating Electron Repulsion Integrals into Effective Potentials}

Consider now an arbirtary functional $\mathcal{F}$ that explicitly depends on the 
ERI's. In this work, OEP's are defined by the following transformation
%
 \begin{equation}
 \mathcal{F}
 \left[ 
   \BraKet{ij}{k^Al^A}
	 \right] = \tBraKet{i}{\hat{v}_{kl}^A}{j}  \;,
 \end{equation}
%
where 
% $A$ and $B$ denote different molecules and $\phi_i$ is the $i$th molecular orbital
%or basis function.
$\hat{v}_{kl}^A$ is the effective one-electron potential operator given by Eq.~\eqref{e:oep-operator} 
with the
effective density $\rho_{kl}^A({\bf r}) \equiv \phi_k^A({\bf r})\phi_l^A({\bf r})$.
The summations over $k$ and $l$ can be incorporated into the total effective one-electron potential operator
$\hat{v}_{\text{eff}}^A$
to produce
%
\begin{equation}
	\sum_{ij}\sum_{kl\in A} \mathcal{F}\left[ 
   \BraKet{ij}{k^Al^A}
 \right] = \sum_{ij} \tBraKet{i}{\hat{v}_{\text{eff}}^A}{j}  \;.
\end{equation}
%
Thus, the total computational effort is, in principle, reduced from the fourth-fold
sum involving evaluation of ERI's to the two-fold sums of cheaper one-electron integrals.
It is also possible to generalize the above expression even further by
summing over all possible functionals ${\mathcal{F}}_t$
%
\begin{equation} \label{e:ft-reduction}
	\sum_t \sum_{ij}\sum_{kl\in A} {\mathcal{F}}_t\left[ 
   \BraKet{ij}{k^Al^A}
 \right] = \sum_{ij} \tBraKet{i}{\hat{v}_{\text{eff}}^A}{j} \;.
\end{equation}
%
The above design has the advantage that it opens the possibility to define first\hyp{}principles
effective fragments as long as 
the functionals ${\mathcal{F}}_t$ 
%the $P_{ij}$ and $P_{ijkl}$ 
%from Eq.~\eqref{e:exp-val-series} 
are computable and can be approximately
partitioned in between the interacting fragments.
%the resulting effective potentials are fully first\hyp{}principles
%and no extensive case\hyp{}dependent fitting procedures are necessary as long as the $P_{ij}$ and $P_{ijkl}$
%are computable.
%Only the effective potentials of \emph{independent} fragment $A$ need to be determined once and for all
%and stored in a file. 
%Note also, that, in principle, there is no approximation 
%made here at that moment.

Two general cases of basis function partitioning scheme
are considered in this work,
in which it is possible to define an effective one\hyp{}electron
potential. They are listed in Table~\ref{t:oep-matrix-element-types}.
The first type is a Coulomb\hyp{}like contribution, for which multipole expansion or density fitting can be used.
The second type is an overlap\hyp{}like contribution, which can be approximated via the density fitting. 
%
{
\renewcommand{\arraystretch}{1.4}
\begin{table}[b]
\caption[Types of matrix elements with OEP operators]
{{\bf Types of matrix elements with OEP operators\footnotemark[1]}
}
\label{t:oep-matrix-element-types}
\begin{ruledtabular}
\begin{tabular}{lcccc}
Matrix element      &&            `Overlap-like'                &&            `Coulomb-like'               \\ 
                    && $\tBraKet{i}{\hat{v}^{A}_{\rm eff}}{j} $ && $\tBraKet{j}{\hat{v}^{A}_{\rm eff}}{l}$ \\ 
	\cline{1-5}
Partitioning scheme &&            $i\in A, j\in B$              &&               $j,l\in B$                \\
Associated ERI's    &&            $\BraKet{AA}{AB}$             &&               $\BraKet{AA}{BB}$         \\
DF\footnotemark[2]/RI\footnotemark[3] Form    
&& $\sum_{\xi\in A}^{\rm Aux} v^A_{i\xi} S^{AB}_{\xi j} $  
&& $\sum_{\xi\zeta\in A}^{\rm Aux} S^{BA}_{j\xi} v^A_{\xi\zeta} S^{AB}_{\zeta l} $ \\
DMTP\footnotemark[4] Form                     
&& --  &  &  $\rho_{jl}^B \odot \rho_{\rm eff}^A$ \\
\end{tabular}
\end{ruledtabular}
%
\footnotetext[1]{Test footnotemark.}
\footnotetext[2]{Density Fitting}
\footnotetext[3]{Resolution of Identity}
\footnotetext[4]{Distributed Multipole Expansion}
%
\end{table}
}
%

\subsection{\label{ss:2.2.oep-DMTP}Distributed Multipole Expansion of OEP's}

This scheme is most applicable in the case of matrix elements of the type
$
 \tBraKet{j^B}{\hat{v}_{\rm eff}^A}{l^B}
$
because it can be considered as a Coulombic interaction between $\rho^B_{jl}$
and $\rho^A_{\rm eff}$. 
In general, given certain two effective one\hyp{}electron density distributions,
the associated effective Coulombic interaction energy can be estimated from the classical formula
according to
%
\begin{equation} \label{e:coulomb-energy:general}
 \Delta^{(XY)}_{\rm eff} E_{\rm Coul} = \iint \frac{\rho_{\rm eff}^X({\bf r}_1) \rho_{\rm eff}^Y({\bf r}_2)}
 {\vert {\bf r}_1 - {\bf r}_2 \vert} 
d{\bf r}_1 d{\bf r}_2 \;.
\end{equation}
%
The above integral can be approximated by the
distributed multipole (DMTP)
expansions of the respective densities as follows
%
\begin{multline} \label{e:coulomb-energy:dmtp}
  \Delta^{(XY)}_{\rm eff} E_{\rm Coul} \approx
 \rho_{\rm eff}^X \odot \rho_{\rm eff}^Y \equiv
 \sum_{u\in A} \sum_{w\in B} \Big\{ 
 T^{(0)}_{uw}
 q_{\rm eff}^{(u)}  q_{\rm eff}^{(w)} \\
 - {\bf T}^{(1)}_{uw} \cdot 
   \left[ q_{\rm eff}^{(u)} {\BM\upmu}_{\rm eff}^{(w)} - q_{\rm eff}^{(w)} {\BM\upmu}_{\rm eff}^{(u)} \right]
 - {\bf T}^{(2)}_{uw} : 
  {\BM\upmu}_{\rm eff}^{(u)}  \otimes {\BM\upmu}_{\rm eff}^{(w)} 
 \ldots
 \Big\}
\end{multline}
%
In the above equations, $q_{\rm eff}^{(u)}$ and ${\BM\upmu}^{(u)}_{\rm eff}$ 
are the effective distributed monopole (charge)
and dipole moment, respectively, centered on the $u$th site, 
whereas ${{\bf T}^{(r)}_{uw}}$ are the so called interaction tensors or rank $r$ 
that can be found elsewhere.
The symbol `$\odot$' denotes the sum of all the tensor contractions
performed over the DMTP's of molecule $X$ and $Y$ to yield the associated interaction energy.
The choice of the distribution centres as well as the truncation order of the multipole expansion
is crucial in compromising the accuracy and computational cost of the resulting expressions.
There is many ways in which this can be achieved, e.g., through the distributed multipole analysis (DMA)
of Stone\cite{Stone.JCTC.2005}
the cumulative atomic multipole moments of Sokalski and Poirier\cite{Sokalski.Poirier.CPL.1983}
the localised distributed multipole expansion (LMTP) of Etchtebest, Lavery and Pullman\cite{Etchebest.Lavery.Pullman.TheorChimActa.1982}
or schemes based on fitting to electrostatic potential such as ChelpG\cite{Breneman.Wiberg.JCC.1990} for instance.

\subsection{\label{ss:2.3.oep-GDF}Density Fitting of OEP's}

This scheme is most useful in the case of matrix elements of the type
$
 \tBraKet{i^A}{\hat{v}_{\rm eff}^A}{j^B}
$.
To get the \emph{ab initio} representation of such an overlap\hyp{}like matrix element,
one can use a procedure similar to
the typical density fitting or resolution of identity, both of which are nowadays widely used 
to compute electron\hyp{}repulsion integrals (ERI's) more efficiently. 

\subsubsection{\label{sss:2.3.1.GDF-1}Density Fitting in Nearly-Complete Space}

An arbitrary one\hyp{}electron potential of molecule $A$ acting on any state vector 
associated with molecule $A$ can be expanded in an auxiliary space centered 
on $A$ as
%
\begin{equation}
   \hat{v}^{A}\Ket{i} = \sum_{\xi\eta}^{\rm RI} \hat{v}^{A}\Ket{\xi} [{\bf S}^{-1}]_{\xi\eta} \BraKet{\eta}{i}
\end{equation}
%
under the necessary assumption that the auxiliary basis set is nearly complete,
i.e., 
$\sum_{\xi\eta}^{\rm RI} \Ket{\xi}[{\bf S}^{-1}]_{\xi\eta} \Bra{\eta} \cong 1$.
In the equations above, 
the `RI' symbol denotes a certain auxiliary basis set that fulfills the resolution of identity. 
%In a special case when the basis set is orthogonal (e.g., molecular orbitals)
%the above relation simplifies to
%\begin{equation}
%   v\vert i) = \sum_{\xi} v\vert \xi) ( \xi \vert i)
%\end{equation}
Such a general expansion can be obtained by 
utilizing the density fitting
in the nearly\hyp{}complete space,
%
\begin{equation} \label{e:v-compl}
 \hat{v}^{A}\Ket{i} = \sum_{\xi}^{\rm RI} V^A_{i\xi} \Ket{\xi} \;.
\end{equation}
%
In the above equation,
the matrix ${\bf V}^A$
is the projection of the state vector $\hat{v}^{A} \Ket{i}$
onto the complete basis $\{ \varphi_\xi \}$.
Let $Z_i[{\bf V}^A]$ be the least\hyp{}squares objective function 
%
\begin{equation} \label{e:z-compl}
 Z_i[{\bf V}^A] = \int \vert \Xi_i({\bf r}) \vert^2 d{\bf r}
\end{equation}
%
with the error density defined by
%
\begin{equation} \label{e:error-compl}
 \Xi_i({\bf r}) = v^A({\bf r}) \phi_i({\bf r}) - \sum_\xi^{\rm RI} V^A_{i\xi} \varphi_\xi({\bf r}) \;.
\end{equation}
%
By requiring that
%
\begin{equation} \label{e:z-necessary-requirement}
 \frac{\partial Z_i[{\bf V}^A]}{\partial V^A_{i\mu}} = 0 \text{ for all $\mu$}
\end{equation}
%
one finds the coefficients of the $i$th row of ${\bf V}^A$ to be
%
\begin{equation} \label{e:gdf-compl.v}
% {\bf v}_i = {\bf a}^{(i)} \cdot {\bf S}^{-1}
  V^A_{i\xi} = \sum_\eta^{\rm RI} [{\bf S}^{-1}]_{\xi\eta} a^{(i)}_\eta \;,
\end{equation}
%
where the auxiliary matrices are given by
%
\begin{subequations}
\begin{align}
 a^{(i)}_\eta &= \int \varphi^*_\eta({\bf r}) \hat{v}^A \phi_i({\bf r}) d{\bf r} \;,\\  
 S_{\eta\xi}  &= \int \varphi^*_\eta({\bf r}) \varphi_\xi({\bf r}) d{\bf r} \;.
\end{align}
\end{subequations}
%
%Since matrix elements of an OEP operator in auxiliary space can be computed 
%in the same way as the matrix elements with any other basis function, 
%one can formally write the following identity
%\begin{equation}
% (X \vert v\vert i) = \sum_{\xi\eta} S_{X \xi} [{\bf S}^{-1}]_{\xi\eta} (\eta\vert v\vert i)
%\end{equation}
%where $ X $ is an arbitrary orbital.
%When the other orbital
%does not belong to molecule $A$ but to the (changing) environment, it is 
%straightforward to compute the resulting matrix element, which is simply given as  
%\begin{equation}
%   (j_{\in B} \vert v^A \vert i_{\in A}) = \sum_\xi {S_{j\xi}} {G_{i\xi}}
%\end{equation}
%where $j$ denotes the other (environmental) basis function.
%
The working formula for $a^{(i)}_\eta$ can be found by applying 
potential form from Eq.~\eqref{e:v-eff}
along with the spectral representation of the effective density from Eq.~\eqref{e:d-spectral} 
which finally gives
%
\begin{equation} \label{e:a-coeff-compl}
 a^{(i)}_\eta = \lambda \sum_{x} W_{\eta i}^{(x)} + 
 \sum_{\alpha\beta} D^A_{\alpha\beta} 
  \BraKet{\alpha\beta}{\eta i} \;.
%  \iint \frac{ \phi_\alpha^*({\bf r}_1)  \phi_\beta({\bf r}_1) \varphi^*_\eta({\bf r}_2) \phi_i({\bf r}_2)}
% {\vert {\bf r}_1 - {\bf r}_2 \vert }
% d{\bf r}_1 d{\bf r}_2
\end{equation}
%

\subsubsection{\label{sss:2.3.1.GDF-2}Density Fitting in Incomplete Space}

Density fitting scheme from previous section has practical disadvantage of a nearly\hyp{}complete basis set
being usually very large (spanned by large amount of basis set vectors). 
Since most of basis sets used in quantum chemistry do not form a nealy complete
set, it is beneficial to design a modified scheme in which it is possible to obtain the effective 
matrix elements of the OEP operator in an incomplete auxiliary space. This can be achieved by minimizing 
the following objective function
%
\begin{equation} \label{e:z-incompl}
	Z_i[{\bf V}^A] = \iint 
        \frac{ \Xi_i^*({\bf r}_1) \Xi_i({\bf r}_2) }{\vert {\bf r}_1 - {\bf r}_2 \vert}  
         d{\bf r}_1 d{\bf r}_2  \;.
\end{equation}
%
with the error density defined by
%
\begin{equation} \label{e:error-incompl}
 \Xi_i({\bf r}) = v^A({\bf r}) \phi_i({\bf r}) - \sum_\xi^{\rm DF} V^A_{i\xi} \varphi_\xi({\bf r}) \;.
\end{equation}
%
where the symbol `DF' denotes the generally incomplete auxiliary basis set.
From the requirement given in Eq.~\eqref{e:z-necessary-requirement}
one obtains
%
\begin{equation} \label{e:v-incompl}
% {\bf G}^{(i)} = {\bf b}^{(i)} \cdot {\bf A}^{-1}
  V^A_{i\xi} = \sum_\eta^{\rm DF} [{\bf R}^{-1}]_{\xi\eta} b^{(i)}_\eta \;,
\end{equation}
%
where 
%
\begin{subequations}
\begin{align}
 b^{(i)}_\eta &= \iint 
                       \frac{ \varphi^*_\eta({\bf r}_1) \hat{v} \phi_i({\bf r}_2) } 
                            {\vert {\bf r}_1 - {\bf r}_2\vert}  
                 d{\bf r}_1 d{\bf r}_2 \;, \\
 R_{\eta\xi}  &= \iint 
                       \frac{ \varphi^*_\eta({\bf r}_1) \varphi_\xi({\bf r}_2) } 
                            {\vert {\bf r}_1 - {\bf r}_2\vert}  
                 d{\bf r}_1 d{\bf r}_2 \;.
\end{align}
\end{subequations}
%
%The symbol $ \vert\vert $ is to denote the operator $ r_{12}^{-1}$ and double integration over $ {\bf r}_1 $
%and $ {\bf r}_2 $. 
Note that, while $R_{\eta\xi}$ is a typical 2\hyp{}center ERI 
that can be evaluated by standard means,
$b^{(i)}_\eta$ matrix elements are not at all trivial to calculate
because the OEP operator, which contains integration over an electron coordinate,
is present inside the double integral. Therefore, the following triple integral,
%
\begin{equation} \label{e:triple-integral}
 b^{(i)}_\eta = \iiint 
           \frac{ \varphi^*_\eta({\bf r}_1) \phi_i({\bf r}_2)  \rho^{\rm eff}({\bf r}_3) }
            {\vert {\bf r}_1 - {\bf r}_2 \vert \vert {\bf r}_3 - {\bf r}_2 \vert}
           d{\bf r}_1 d{\bf r}_2 d{\bf r}_3 \;,
\end{equation}
%
has to be computed.
Obtaining all the necessery integrals of this kind directly 
by performing integrations in Eq.~\eqref{e:triple-integral} is very costly 
and impractical even for medium sized molecules. 
However, one can introduce the effective potential in order to eliminate one integration. 
This can be achieved by performing additional density fitting in a nearly complete intermediate basis 
%
\begin{equation}
 \hat{v}^{\rm eff} \Ket{i} = \sum_\varepsilon^{\rm RI} H_{i\varepsilon} \Ket{\varepsilon} \;,
\end{equation}
%
%where the symbol `RI' denotes the intermediate basis from a chosen resolution of identity.
The working equation is therefore given by
%
\begin{equation} \label{e:v-compl-b-coeff}
 b^{(i)}_\eta = \sum_\varepsilon^{\rm RI} H_{i\varepsilon} R_{\varepsilon\eta} \;,
\end{equation}
%
%with
%%
%\begin{equation}
% R_{\varepsilon\eta} \equiv \iint 
%                       \frac{ \varphi^*_\varepsilon({\bf r}_1) \varphi_\eta({\bf r}_2) } 
%                            {\vert {\bf r}_1 - {\bf r}_2\vert}  
%                 d{\bf r}_1 d{\bf r}_2 \;,
%\end{equation}
%%
which can be easily evaluated by noting that
$H_{i\varepsilon}$ are given by Eq.~\eqref{e:v-compl}.
Thus, the matrix elements of the OEP operator can be found
by using Eq.~\eqref{e:v-incompl}.
%Therefore, in order to use this generalized density fitting scheme
%one must to compute two\hyp{}centre electron repulsion integrals
%as well as four\hyp{}centre asymmetric electron repulsion integrals of the type $ (\alpha\beta\gamma||\eta) $.
%The evaluation of such integrals is discussed in Appendix~\ref{a:mcmurchie-davidson}.

It is emphasized here that, as long as the state vector $\Ket{i}$, OEP operator $\hat{v}^A$ 
and the auxiliary and intermediate basis sets depend solely on one unperturbed molecule $A$, the matrix elements
$V^A_{i\xi}$ can be calculated just once and stored in a file as effective fragment parameters.




\section{\label{s:3.ct}Charge Transfer Interaction Energy for Fragment Potentials}

In the CT/HF0 treatments of bi\hyp{}molecular complexes, the CT energy
can be expressed as a sum of the energy stabilization due to 
CT from molecule $A$ to $B$ and vice versa, i.e.,
%
\begin{equation} \label{e:ct-hf0}
 U^{\rm CT} =  E^{A\rightarrow B} + E^{B\rightarrow A}\;.
\end{equation}
%

\subsection{\label{ss:3.1.EFP2} EFP2 Model}

Li, Gordon and Jensen used the expansion of the overlap density 
in Taylor series and found four different approximate
theories for the CT energy.\cite{Li.Gordon.Jensen.JCP.2006} 
The optimal theory, which was shown
to well reproduce the CT/HF0 energies obtained by using 
the reduced variational space (RVS)
analysis of Stevens and Fink\cite{Stevens.Fink.CPL.1987},
reads
%
\begin{equation} \label{e:u-efp2-ct}
 E^{A\rightarrow B} \approx 
 2\sum_{i\in A}^{\rm Occ}
  \sum_{n\in B}^{\rm Vir}
   \frac{ \left| V_{in}^{A\rightarrow B} \right|^2}{\varepsilon_{i} - T_{nn}} \;,
\end{equation}
%
where
%
\begin{multline} \label{e:u-efp2-ct-v2}
 \left| V_{in}^{A\rightarrow B} \right|^2 \approx
 \frac{U_{in}}{1-\sum_{m\in A}^{\rm All} S_{mn}^2}
 \Bigg\{
   U_{in} \\ + \sum_{j\in B}^{\rm Occ} S_{ij} 
   \left( 
     T_{nj} - \sum_{m\in A}^{\rm All} S_{nm} T_{mj}
   \right)
 \Bigg\} \;,
\end{multline}
%
and 
%
\begin{equation} \label{e:uin-efp2}
 U_{in} \equiv V_{in}^{{\rm EF},B} - \sum_{m\in A}^{\rm All} V_{im}^{{\rm EF},B} S_{mn} \;,
\end{equation}
%
in which the summations extend over occupied (denoted by `Occ'), virtual (denoted by `Vir') 
or both (denoted by `All') MO's. The effective potential 
matrices are defined by
%
\begin{equation} \label{e:v-efp2-eff}
 V_{in}^{{\rm EF},B} \equiv 
 \tBraKet{i}{\hat{v}^B_{\rm tot} }{n} \;,
\end{equation}
%
and are evaluated by expanding the $\hat{v}^B_{\rm tot}$ operator
in distributed multipoles. The resulting calculation requires computation
of potential, electric field and electric field gradient one\hyp{}electron integrals
and their contractions with the DMTP distributions.
The apparent success of the EFP2 scheme is rooted in the dramatic simplifications of the
\emph{ab initio} expressions for interaction energy, in which
the relatively very costly ERI's
have been effectively removed from the working models while maintaining the required accuracy. 
That is, the canonical orbital energies $\varepsilon_i$ are
constant parameters, whereas the overlap $S_{nm}$, kinetic energy $T_{mn}$ and effective
one\hyp{}electron electrostatic potential $V_{in}^{{\rm EF}}$ matrix elements
are all certain types of the one\hyp{}electron integrals, orders of magnitude cheaper to
evaluate than ERI's. Unfortunately, due to extensive summations over virtual orbitals
evaluating Eq.~\eqref{e:u-efp2-ct} is still considerable in cost because typically large basis sets
need to be used for generating the EFP2 parameters. Moreover, calculation of $V_{in}^{{\rm EF}}$
is much more expensive as compared to other types of one\hyp{}electron integrals.

In the following subsections, the alternative model of the CT/HF0 energy is proposed
by introducing OEP's. Although application of the OEP method to the CT/HF0 formulation in EFP2 method
is probably possible, it would be relatively difficult to discuss the resulting OEP\hyp{}based
EFP2 models because there are four distinct versions of this theory
with a set of different approximations, selected based on performance assessment rather than 
a rigorous derivation manner.
Instead, perturbation theory of Murrell et al.\cite{Murrell.Randic.Williams.Longuet-Higgins.ProcRSocLondA.1965} 
with the
explicit formulation for closed shell systems by Otto and Ladik\cite{Otto.Ladik.ChemPhys.1975},
which is somewhat more rigorous than the EFP2 CT model,
is chosen as a starting point in this work. 
It is believed that this choice will allow a clear demonstration 
of the OEP technique in fragment\hyp{}based modelling.


\subsection{\label{ss:3.2.OL} Murrell et al.'s Model: Starting Point}

%According to the second\hyp{}order intermolecular perturbation theory 
%with wavefunction overlap of Murrell et al.,
%the energy associated with the charge transfer from molecule $A$ to $B$ is given by
The CT/HF0 energy can be expressed
by\cite{Murrell.Randic.Williams.Longuet-Higgins.ProcRSocLondA.1965,Otto.Ladik.ChemPhys.1975}
%
\begin{equation} \label{e:ct-murell-etal.e}
 E^{A\rightarrow B} = 2 \sum_{i\in A}^{\rm Occ} \sum_{n\in B}^{\rm Vir} 
  \frac{\vert V^{A\rightarrow B}_{in} \vert^2 }{\varepsilon_i - \varepsilon_n}
\end{equation}
%
%coupling constants between occupied and virtual molecular orbitals 
%are re-expressed by the effective one-electron potentials. The resulting formula provides new possibilities 
%of optimization and applications in condensed phase simulations. [3]
%
where $\varepsilon_i$ and $\varepsilon_n$ are the canonical energies
of the occupied and virtual
HF molecular orbitals, respectively,
whereas the coupling constant is given by
%
\begin{multline} \label{e:ct-murell-etal.vin}
 V^{A\rightarrow B}_{in} = 
        \tBraKet{i}{\hat{v}^B_{\rm tot} }{n} 
      - \sum_{j\in B}^{\rm Occ} \BraKet{nj}{ij} 
      - \sum_{k\in A}^{\rm Occ} S_{nk} \tBraKet{k}{\hat{v}^B_{\rm tot} }{i} \\
      - \sum_{j\in B}^{\rm Occ} S_{ij} \tBraKet{j}{\hat{v}^A_{i} }{n}  
     + \sum_{k\in A}^{\rm Occ} \sum_{j\in B}^{\rm Occ}  
        S_{kj} \left(1+\delta_{ik}\right) \BraKet{nj}{ik} \;.
\end{multline}
%
In the above expression, the following effective one\hyp{}electron operators,
%
\begin{subequations} 
\begin{align} \label{e:ct-murell-etal.vtot-vi}
 \hat{v}^B_{\rm tot} &= \hat{v}^B_{\rm nuc} + 2\sum_{j\in B}^{\rm Occ} \hat{v}^B_{jj} \quad\text{ and }\\ 
 \hat{v}^A_{i      } &= \hat{v}^A_{\rm tot} - 2\hat{v}^A_{ii} \;,
\end{align}
\end{subequations}
%
were introduced without making any approximation to the original equation
from Ref. 
The goal of this work is to apply the technique sketched in Eq.XXX
to eliminate ERI's from Eq.~\eqref{e:ct-murell-etal.vin} in terms of OEP's.

\subsection{\label{ss:3.3.OEP} Murrell et al.'s Model: Application of OEP Technique}

One can immediately notice that the five summation terms
from Eq.~\eqref{e:ct-murell-etal.vin} can be classified into three groups
regarding the type of ERI's that are required:
(i) $\BraKet{AB}{BB}$ -- the first two terms;
(ii) $\BraKet{AA}{BB}$ -- the third term and
(iii) $\BraKet{BB}{AA}$ -- the two last terms. 
Note also that there are no exchange\hyp{}like terms needed in this case.
Therefore, all the contributions can be re\hyp{}cast in terms of the OEP's.
%Note that groups (ii) and (iii) correspond to the Coulomb interactions between
%The group (i) corresponds to the overlap\hyp{}like integrals, whereas the groups (ii) and (iii)
%correspond to the Coulomb\hyp{}like integrals

\paragraph{Group (i).}
Group (i) can be rewritten by noticing that
%
\begin{equation} \label{e:ct-murell-etal.group-i.notice}
 \sum_{j\in B}^{\rm Occ} 
 \BraKet{nj}{ij} =
 \Bra{i} \left[ \hat{v}^B_{nj} \Ket{j} \right]  \;,
\end{equation}
%
which, by combining with the first term from Eq.~\eqref{e:ct-murell-etal.vin}, 
allows to apply the density fitting in an
incomplete basis set as follows
%
\begin{equation} \label{e:v-oep.ct}
\Bra{i} \left[ \hat{v}^B_{\rm tot} \Ket{n} - \sum_{j\in B}^{\rm Occ} \hat{v}^B_{nj} \Ket{j} \right]
\cong \Bra{i} \sum_{\eta\in B}^{\rm DF} V^B_{n\eta} \Ket{\eta}
\end{equation}
%
with the error density defined by
%
\begin{multline}
 \Xi_n({\bf r}) = 
  \left\{
      v_{nuc}^B({\bf r}) + 2 \sum_{j\in B}^{\rm Occ}
   \int \frac{ \vert \phi_j({\bf r}') \vert^2 }{\vert {\bf r}' - {\bf r} \vert} d{\bf r}'
  \right\}
  \phi_n({{\bf r}})  \\
 - \sum_{j\in B}^{\rm Occ} \phi_j({{\bf r}})
   \int \frac{ \phi^*_n({\bf r}') \phi_j({{\bf r}'}) }{\vert {\bf r}' - {\bf r} \vert} d{\bf r}'
 - \sum_{\eta\in B}^{\rm DF} V^B_{n\eta} \varphi_\eta({\bf r}) \;.
\end{multline}
%
Substituting the above equation into Eq.~\eqref{e:z-incompl}
%and then
%using resolution of identity to simplify the 
leads to
%
\begin{equation} \label{e:v-oep-group-1-prefinal}
 V^B_{n\xi} = \sum_{\eta\in B}^{\rm DF} \left[ {\bf R}^{-1} \right]_{\xi\eta} b_\eta^{(n)} \;,
\end{equation}
%
where
%
\begin{multline}
 b^{(n)}_\eta = \iint 
           d{\bf r}_1 d{\bf r}_2  
           \frac{ \varphi^*_\eta({\bf r}_1) }
            {\vert {\bf r}_1 - {\bf r}_2 \vert } \\ \times
          \left[ 
           \hat{v}^B_{\rm tot}  \phi_n({\bf r}_2) 
         - \sum_{j\in B}^{\rm Occ} \hat{v}^B_{nj} \phi_j({{\bf r}_2})
           \right]  \;.
\end{multline}
%
The above result is given by a sum of triple integrals from Eq.~\eqref{e:triple-integral}.
However, the following application of the resolution of identity,
%
\begin{equation}
 \hat{v}^B_{\rm tot} \Ket{n} - \sum_{j\in B}^{\rm Occ} \hat{v}^B_{nj} \Ket{j}
 \cong \sum_{\varepsilon\in B}^{\rm RI} H_{n\varepsilon}^B \Ket{\varepsilon} \;,
\end{equation}
%
leads to a much simpler formula
that requires only the one\hyp{} and two\hyp{}electron integrals. 
Therefore, by combining
equations~\eqref{e:v-oep-group-1-prefinal}, \eqref{e:v-compl-b-coeff} and \eqref{e:gdf-compl.v}
one arrives to
%
\begin{equation} \label{e:v-oep-group-1-final}
 V^B_{n\xi} = \sum_{\eta\in B}^{\rm DF} 
          \sum_{\varepsilon\in B}^{\rm RI}
         \left[ {\bf R}^{-1} \right]_{\xi\eta}
         R_{\eta \varepsilon} 
         H_{n\varepsilon}^B \;,
\end{equation}
%
where
%
\begin{equation} \label{e:v-oep-group-1-final:H-matrix}
 H_{n\varepsilon}^B = \sum_{\zeta\in B}^{\rm RI} \left[ {\bf S}^{-1} \right]_{\varepsilon\zeta}
   a_\zeta^{(n)}
\end{equation}
%
and
%%
\begin{align} \label{e:v-oep-group-1-final:a-vector}
 a^{(n)}_\zeta &= \tBraKet{\zeta}{\hat{v}^B_{\rm tot}}{n}
      - \sum_{j\in B}^{\rm Occ} \tBraKet{\zeta}{\hat{v}^B_{nj}}{j} \nonumber \\
 &= \sum_{y\in B} W^{(y)}_{\zeta n} 
  + \sum_{j\in B}^{\rm Occ} 
  \left\{
   2\BraKet{\zeta n}{jj} - \BraKet{\zeta j}{nj} 
  \right\} \;.
\end{align}
%
Note that all the calculations that are required to obtain $V^B_{n\xi}$ are performed
solely on the densities and basis sets associated with the unperturbed molecule $B$.
Therefore, $V^B_{n\xi}$ can be considered as effective fragment parameters
used to compute the first two terms of Eq.~\eqref{e:ct-murell-etal.vin} by
%
\begin{equation} \label{e:ct.group-i.final}
        \tBraKet{i}{\hat{v}^B_{\rm tot} }{n} 
      - \sum_{j\in B}^{\rm Occ} \BraKet{nj}{ij} 
       = \sum_{\eta\in B}^{\rm RI} V^B_{n\eta} S_{\eta i} \;,
\end{equation}
%
which is a great simplification over the original form of group (i)
because only the overlap integrals between the $i$th MO on molecule $A$
and $\eta$th auxiliary orbital on molecule $B$ need to be evaluated on the fly.
Note that the only approximation made so far was the application of density fitting
and resolution of identity. If the auxiliary and intermediate
basis sets are sufficiently large, the errors
due to this approximation can be minimal and negligible.



\paragraph{Group (ii).}
The term belonging to this group can be considered as a sum of interaction
energies between the total charge density distribution of molecule $B$
and the partial density $\rho_{ik}({\bf r})$ of molecule $A$,
weighted by the overlap integrals $S_{nk}$. Using the distributed multipole 
expansion based on the charge centroids of the localized molecular orbitals (LMO's),
${\bf r}_i = \tBraKet{i}{\hat{\bf r}}{i}$ with $\chi_i({\bf r})$ being localized,
this group can be written as
%
\begin{equation} \label{e:ct.group-2}
      - \sum_{k\in A}^{\rm Occ} S_{nk}  \tBraKet{k}{\hat{v}^B_{\rm tot} }{i} 
 \cong - \sum_{k\in A}^{\rm Occ} S_{nk} \rho_{ki}^A \odot \rho^B_{\rm tot} \;.
\end{equation}
%
Note that, in general, $\rho_{ki}^A$ is complex whereas $\rho^B_{\rm tot}$ is always real.
Since the interaction energy must also be real, it must hold that
%
\begin{equation} \label{e:ct.group-2-d}
 \rho_{ki}^A \odot \rho^B_{\rm tot} = \delta_{ik} \rho_{ii}^A \odot \rho^B_{\rm tot} \;.
\end{equation}
%
Consider now a situation in which the localized occupied MO's are used.
In this case, the distributed multipole expansion
of the above becomes
%
\begin{multline}
 \rho_{ii}^A \odot \rho^B_{\rm tot} 
 \approx 
 q_{i} 
 \left[
  %\sum_{i\in A}^{\rm LC} 
 \sum_{y\in B}^{\rm At}
  \frac{Z_y}{\vert {\bf r}_y - {\bf r}_i \vert } 
 +
 2\sum_{j\in B}^{\rm LC}
  \frac{q_j}{\vert {\bf r}_j - {\bf r}_i \vert } 
 \right] \\
 + \text{ quadrupole terms } \;,
\end{multline}
%
because the distributed charges
$q_i = -1$ whereas the distributed dipole moments %${\BM{\upmu}_i}$ 
centered at their
respective LMO charge centroids vanish.\cite{Etchebest.Lavery.Pullman.TheorChimActa.1982}
This means that Eq.~\eqref{e:ct.group-2} can be approximated as follows:
%
\begin{equation} \label{e:ct.group-ii.final}
      - \sum_{k\in A}^{\rm Occ} S_{nk} \tBraKet{k}{\hat{v}^B_{\rm tot} }{i} 
 \approx S_{ni}  \left[
  %\sum_{i\in A}^{\rm LC} 
 \sum_{y\in B}^{\rm At}
  \frac{Z_y}{ r_{yi} } 
 -
 \sum_{j\in B}^{\rm LC}
  \frac{2}{r_{ji}} 
 \right] \;.
\end{equation}
%
Therefore, only overlap integrals and relative distances between
atomic and LC's are needed, which leads to a great reduction of the
calculation cost,
as compared either to the original expression or to the multipole expansion (left\hyp{} and right\hyp{}hand sides
of Eq.~\eqref{e:ct.group-2}, respectively).
We shall refer to this approximation as to
the spherical overlap approximation (SOA). Note that in order for this approximation to be valid,
occupied molecular orbitals need to be localized.

\paragraph{Group (iii).}
The terms with the overlap integrals involving the occupied MO on $A$
can be combined into a single summation term, i.e.,
\begin{multline} \label{e:ct.group-iii}
       - \sum_{j\in B}^{\rm Occ} S_{ij} \tBraKet{j}{\hat{v}^A_{i} }{n}  
     + \sum_{k\in A}^{\rm Occ} \sum_{j\in B}^{\rm Occ}  
        S_{kj} \left( 1 - \delta_{ik} \right)
        \BraKet{nj}{ik} \\ = -
 \sum_{k\in A}^{\rm Occ} 
 \sum_{j\in B}^{\rm Occ}
 S_{kj} 
 \tBraKet{j}{
 \underbrace{
 \left\{ 
  \delta_{ik} \left( \hat{v}^A_{k} + \hat{v}^A_{ik} \right)   - \hat{v}^A_{ik}
 \right\} 
  }_{\hat{v}^{A,{\rm eff}}_{ik}}
 }{n}  \\ \cong -
%
  \sum_{k\in A}^{\rm Occ} 
 \sum_{j\in B}^{\rm Occ}
 S_{kj} 
 \rho_{nj}^B \odot \rho^{A,{\rm eff}}_{ik} \;,
\end{multline}
%
where the effective potential ${v}^{A,{\rm eff}}_{ik}$ (with the associated 
effective density $\rho^{A,{\rm eff}}_{ik}$) 
is defined by
%
\begin{equation} \label{e:ct.group-iii.oep}
 {v}^{A,{\rm eff}}_{ik}({\bf r}) \equiv
 \delta_{ik} 
 \left[
  v^A_{\rm tot} ({\bf r}) - 2 v^A_{kk} ({\bf r}) + v^A_{ik} ({\bf r})
 \right] 
  - v^A_{ik} ({\bf r}) \;.
\end{equation}
%
Now, it is first assumed here that $\rho^{B}_{nj} ({\bf r}) \approx 0$ if occupied MO's on $B$ are localized.
This means that
%
\begin{multline} \label{e:ct.group-iii.final.a}
        - \sum_{j\in B}^{\rm Occ} S_{ij} \tBraKet{j}{\hat{v}^A_{\rm tot} }{n}  
     + \sum_{k\in A}^{\rm Occ} \sum_{j\in B}^{\rm Occ}  
        S_{kj} \left( 1 - \delta_{ik} \right)
        \BraKet{nj}{ik} \\ 
    \approx 0 \;.
\end{multline}
%
The above result is a crude approximation, since the channels $j\rightarrow n$
are quite important contributions in most of perturbation theory treatments.
%virtual MO's can penetrate the occupied MO's to some extent.
In order to include the $\rho^{B}_{nj}$ density, it is approximately represented here by a set of effective 
cumulative
atomic charges $\{ q^{B,(nj)}_{y} \}$ associated with the effective one\hyp{}particle density matrix
%
\begin{equation} \label{e:oed-group-iii}
 D^{B,(nj)}_{\beta\delta} = C_{\beta n} C_{\delta j} \;.
\end{equation}
%
In this work, the effective charges were computed via the Mulliken method as
discussed in Appendix~\ref{e:a1-v.oep-camm} with $\lambda=0$. 
Note now that both effective densities in 
$\rho^B_{jn} \odot \rho^{A,{\rm eff}}_{ik}$ are generally complex and one cannot apply the SOA
for $\rho^{A,{\rm eff}}_{ik}$. In the LMO picture however, it can be shown that
$\rho_{ik} ({\bf r}) \ll \rho_{ii} ({\bf r})$ 
for $i\ne k$ in most locations. Therefore,
the SOA is still applicable in the LMO picture
and the effective potential from Eq.~\eqref{e:ct.group-iii.oep} 
simplifies to
%
\begin{equation} \label{e:ct.group-iii.oep.simplified}
 {v}^{A,{\rm eff}}_{ik}({\bf r}) \approx
 \delta_{ik} \left\{
 {v}^A_{\rm tot} ({\bf r})- 2{v}^A_{kk} ({\bf r}) \right\} \;,
\end{equation}
%
which
leads to 
%
\begin{multline} \label{e:ct.group-iii.final.b}
        - \sum_{j\in B}^{\rm Occ} S_{ij} \tBraKet{j}{\hat{v}^A_{\rm tot} }{n}  
     + \sum_{k\in A}^{\rm Occ} \sum_{j\in B}^{\rm Occ}  
        S_{kj}
        \BraKet{nj}{ik}  \\
 \approx  -
 \sum_{j\in B}^{\rm Occ} S_{ij}
 \sum_{y\in B}^{\rm At} 
 q^{B,(nj)}_{y} 
 \left[ 
   \sum_{x\in A}^{\rm At}
   \frac{Z_x}{r_{xy}}
  + \frac{2}{r_{iy}}
  - \sum_{k\in A}^{\rm Occ}
    \frac{2}{r_{ky}} 
 \right]
 \;.
\end{multline}
%


\paragraph{Final OEP-based forms of the coupling constant.}
Gathering the results from Eqs. the coupling constant
can be given as follows
%
\begin{equation} \label{e:ct-murell-etal.vin.oep}
V_{in}^{A\rightarrow B} 
       \approx 
 G_{1;in}^{A\rightarrow B} 
+G_{2;in}^{A\rightarrow B} 
+G_{3;in}^{A\rightarrow B} \;,
\end{equation}
%
where
%
\begin{subequations} \label{e:ct-murrell-etal.vin.oep-gterms}
\begin{align}
 G_{1;in}^{A\rightarrow B} &\equiv \sum_{\eta\in B}^{\rm RI} V^B_{n\eta} S_{\eta i} \;, \\
 G_{2;in}^{A\rightarrow B} &\equiv S_{ni} u_i^{BA} \;, \\
 G_{3;in}^{A\rightarrow B} &\equiv
 -\sum_{j   \in B}^{\rm Occ} S_{ij}
  \sum_{y   \in B}^{\rm At} q_y^{B,(nj)} w_{yi}^{BA}
\;.
\end{align}
\end{subequations}
%
In the above, the auxiliary variables are
%
\begin{subequations}
\begin{align} \label{e:ct-murell-etal.vin.oep.aux-var}
 u_i^{BA} &\equiv    
 \sum_{y\in B}^{\rm At}
  \frac{Z_y}{ r_{yi} } 
 -
 \sum_{j\in B}^{\rm LC}
  \frac{2}{r_{ji}} 
                \;, \\
 w_{yi}^{BA} &\equiv 
   \sum_{x\in A}^{\rm At}
   \frac{Z_x}{r_{xy}}
  + \frac{2}{r_{iy}}
  - \sum_{k\in A}^{\rm Occ}
    \frac{2}{r_{ky}} 
                \;.
\end{align}
\end{subequations}
%
To compute the interaction energy due to CT from $A$ to $B$ by using the above SOA\hyp{}based
approximations, coupling elements need to be transformed from localized to canonical MO basis, i.e.,
%
\begin{equation} \label{e:ect-oep.prefinal}
 E^{A\rightarrow B} \approx 
 2 
 \sum_{i\in A}^{\rm CMO}
 \sum_{n\in B}^{\rm Vir}
 \frac{
 \lvert
   \sum_{i'\in A}^{\rm LMO} L_{ii'}^A
   V_{i'n}^{A\rightarrow B}
 \rvert^2 }{\varepsilon_i - \varepsilon_n} \;,
\end{equation}
%
where ${\bf L}^A$ is the CMO\hyp{}LMO transformation matrix for occupied orbitals of $A$. 
Note however, that the effective potential parameters from the density fitted term of group (i) 
do not involve any occupied orbitals.
Therefore, to save computational costs, only groups (ii) and (iii) need to be transformed
whereas for group (i) the overlap integrals from Eq.~\eqref{e:ct.group-i.final} 
can be already evaluated in CMO basis.
Thus, the final working formula for the interaction energy due to CT from $A$ to $B$ reads
%
\begin{multline} \label{e:ect-oep.final}
 E^{A\rightarrow B} \approx
 2 
 \sum_{i\in A}^{\rm CMO}
 \sum_{n\in B}^{\rm Vir}
 \frac{1}{\varepsilon_i - \varepsilon_n} \times 
 \Bigg(
   G_{1,in}^{A\rightarrow B} \\
  +
   \sum_{i'\in A}^{\rm LMO} L_{ii'}^A
   \left\{
   G_{2,i'n}^{A\rightarrow B}
  +G_{3,i'n}^{A\rightarrow B}
  \right\}
 \Bigg)^2 \;,
\end{multline}
%
where the subscripts $G_n$ ($n$ = 1, 2, 3) denote a particular group of 
terms from Eqs.~\eqref{e:ct.group-i.final}, \eqref{e:ct.group-ii.final} and \eqref{e:ct.group-iii.final.a}
or \eqref{e:ct.group-iii.final.b}. 
The total CT energy is given by the sum of the above contribution and the twin contribution
due to CT from molecule $B$ to $A$ according to Eq.~\eqref{e:ct-hf0}.

%
%he above formula does not explicitly define an OEP due to the summation over different
%state vectors. 
%However, it can be achieved
%by transforming from MO to AO basis, i.e.,
%%
%\begin{equation}
% \hat{v}^B_{\rm tot} \Ket{n} - \sum_{j\in B}^{\rm Occ} \hat{v}^B_{nj} \Ket{j}
% = \sum_{\beta\in B}^{\rm AO} 
% \left\{ 
%  C_{\beta n} \hat{v}^B_{\rm tot} - \sum_{j\in B}^{\rm Occ} C_{\beta j} \hat{v}^B_{nj} 
% \right\} \Ket{\beta} \;,
%\end{equation}
%%
%which leads to the OEP in spatial representation
%%
%\begin{multline}
% v_{\beta n}({\bf r}) \equiv C_{\beta n} v_{nuc}^B({\bf r}) \\ + 
%  \sum_{j\in B}^{\rm Occ} \Bigg\{ 
%   2 C_{\beta n} \int \frac{ \vert \phi_j({\bf r}') \vert^2 }{\vert {\bf r}' - {\bf r} \vert} d{\bf r}'
% %\\
% - C_{\beta j} \int \frac{ \phi^*_n({\bf r}') \phi_j({\bf r}') }{\vert {\bf r}' - {\bf r} \vert} d{\bf r}'
%  \Bigg\}  
%%
%\end{multline}
%




\section{\label{s:4.calculations}Calculation Details}

Four selected molecular pairs composed of H$_2$O, CH$_3$OH, NH$_4^+$ and NO$_3^-$
(Figure 1) molecules or ions were chosen to validate the OEP\hyp{}based model of the CT energy
at the PT/HF formulation level. Structures of the molecular dimers were first 
energy\hyp{}optimized at the HF/6-31+G(d,p) level by using
the Gaussian 16 quantum chemistry program package.\cite{Gaussian16}
To obtain the PT/HF benchmark CT energy, it was estimated
from the following approximation:
%
\begin{equation}\label{e:ct-pthf-ref}
 \Delta E^{\rm CT}_{\rm PT/HF} \cong \Delta E^{\rm Pol}_{\rm DDS/HF} 
 - \Delta E^{\rm Ind} \;,
\end{equation}
%
where $\Delta E^{\rm Pol}_{\rm DDS/HF}$ is the Hartree\hyp{}Fock polarization energy
defined
according to the density decomposition scheme (here referred as to the DDS) 
proposed by Mandado and Hermida\hyp{}Ram{\'o}n,\cite{Mandado.Hermida-Ramon.JCTC.2011} 
whereas $\Delta E^{\rm Ind}$ term is the 
approximate pure induction energy due to the polarizability effects.\cite{Stone.TheTheoryOfIntermolecularForces.1996}
The DDS polarization energy encompasses all the charge delocalization
effects that are not associated with the Pauli exclusion principle
in the first order, and is computed by
%
\begin{multline}\label{e:de-pol-dds}
\Delta E^{\rm Pol}_{\rm DDS/HF} \equiv \Delta E^{\rm HF} \\
 - \left(
   \Delta E^{\rm Coul}_{\rm DDS/HF}
 + \Delta E^{\rm Exch}_{\rm DDS/HF}
 + \Delta E^{\rm Rep}_{\rm DDS/HF} 
   \right)\;.
\end{multline}
%
In the above, $\Delta E^{\rm Coul}_{\rm DDS/HF}$ is the pure Coulombic interaction energy
between the unperturbed (non\hyp{}interacting) charge densities of the monomers in the complex,
and
$\Delta E^{\rm Exch}_{\rm DDS/HF}$ and $\Delta E^{\rm Rep}_{\rm DDS/HF}$
are the exchange and the Pauli\hyp{}repulsion interaction energies, respectively. 
At the HF level of theory, the sum of the latter two terms is in fact
equivalent to the first\hyp{}order exchange\hyp{}repulsion energy 
in the intermolecular perturbation theory with exchange of Hayes and Stone.\cite{Hayes.Stone.MolPhys.1984} 
It was also shown by 
Mandado and Hermida\hyp{}Ram{\'o}n,\cite{Mandado.Hermida-Ramon.JCTC.2011}
that the Coulombic and exchange\hyp{}repulsion term
in the DDS method reproduce the first\hyp{}order Coulombic and exchange\hyp{}repulsion
interaction energy in the symmetry adapted perturbation theory\cite{Jeziorski.Moszynski.Szalewicz.ChemRev.1994}
(SAPT)
with accuracy below 0.3 kcal/mole.
Therefore, Eq.~\eqref{e:ct-pthf-ref} is believed to be sufficient
in order to compute the PT/HF CT energy, because there is no dispersion
contribution to the DDS polarization energy at the HF level.

The pure induction energy was estimated by using the distributed
dipole\hyp{}dipole polarizability approximation according to the computational
methodology of Li et al.,\cite{Li.Netzloff.Gordon.JCP.2006}
in which
%
\begin{equation}\label{e:ind-ref}
 \Delta E^{\rm Ind} \approx - \frac{1}{2} {\bf F}^{\rm T} \cdot {\bf D}^{-1} \cdot {\bf F} \;.
\end{equation}
%
In the above equation, ${\bf F} = \{ \ldots, {\bf F}({\bf r}_a), \ldots\}$
is a super\hyp{}vector of electric fields at the $a$th distributed site
due to the surrounding unperturbed molecular charge densities in the complex
(i.e., the charge\hyp{}density of the molecule that contains $a$th center
is not included in ${\bf F}({\bf r}_a)$).
%The electric field components are
%aligned in a super\hyp{}vector 
%according to each polarizable center, i.e. ${\bf F} = \{ \ldots, {\bf F}({\bf r}_a), \ldots\}$,
%where $a$ labels the LMO centroids.
The ${\bf D}$ matrix is defined as
%
\begin{equation} \label{e:ind-ref.d-matrix}
 {\bf D}_{ab} = 
\left\{\begin{matrix}
{\BM\upalpha}_a^{-1} &\text{if $a=b$} \\ 
0                    &\text{if $a\ne b \land a,b \in$ same molecule}\\ 
-{\bf T}_{ab}        &\text{if $a\ne b \land a,b \notin$ same molecule}
\end{matrix}\right.
\end{equation}
%
and ${\bf T}_{ab}$ is the dipole\hyp{}dipole interaction tensor
given by
%
\begin{equation} \label{e:ind-ref.t-matrix}
 {\bf T}_{ab} \equiv \frac{3}{r_{ab}^5} {\bf r}_{ab} \otimes {\bf r}_{ab}
  - \frac{1}{r_{ab}^3} {\bf 1} \;,
\end{equation}
%
with ${\bf r}_{ab} \equiv {\bf r}_{a} - {\bf r}_{b}$ being the
relative distance between the LMO centroids.
The electric fields at the LMO centroids were computed from
the unperturbed HF charge\hyp{}density distributions
%
\begin{equation} \label{e:ind-ref.efield}
 {\bf F}({\bf r}_a) = \sum_x^{\rm At} \frac{Z_x}{r_{ax}^3} {\bf r}_{ax} 
  + 2 \sum_{\alpha\gamma} D_{\alpha\gamma} 
%    \tBraKet{\gamma}{\frac{{\bf r}_a - {\bf r}}{\vert {\bf r}_a - {\bf r} \vert^3} }{\alpha}_{\bf r} \;.
  \left< \gamma \left| 
    \frac{{\bf r}_a - {\bf r}}{\vert {\bf r}_a - {\bf r} \vert^3}
               \right| \alpha \right>_{\bf r} \;.
\end{equation}
%
The distributed anisotropic dipole\hyp{}dipole
polarizabilities ${\BM{\upalpha}}_a$ centered at the LMO centroids
were computed by utilizing the coupled\hyp{}perturbed Hartree\hyp{}Fock
method.\cite{McWeeny.RevModPhys.1960,Dodds.McWeeney.Sadlej.MolPhys.1977} 
Orbital localization was performed by using the Boys method.\cite{Boys.RevModPhys.1960} 

All the models that were used to test the theory presented in this work
were implemented in our in\hyp{}house plugin to {\sc Psi4} quantum chemistry program.\cite{Psi4.JCTC.2017}

\section{\label{s:5.results}Results and Discussion}

\subsection{\label{ss:5.1.accuracy}Accuracy of OEP-based model}

First, the asymptotic dependence of the CT energy
was investigated for four chosen molecular pairs and the results are
shown in Figure~\ref{f:fig-2} and Figure~S1 for the methanol-water system. 
Overall, OEP technique of effective
elimination of ERI's sketched in Eq.~\eqref{e:ft-reduction} 
works
quantitatively well for water dimer and ammonium nitrate (Figures~\ref{f:fig-2}(a) and (c)),
and methanol-water (Figure~S1)
reproducing the reference Otto\hyp{}Ladik CT energy,
whereas in the case of water\hyp{}ammonium cation complex the OEP
method overestimates the CT energy by around 50\%, even for large
intermonomer separations. Careful inspection
(see SI)
revealed that the reason is the SOA in $G_2$ and $G_3$ and not
the generalized density fitting in $G_1$ terms, in the case of which
the aug-cc-pVDZ-jkfit basis set was sufficient as auxiliary space of OEP transformation.
On the other hand, analysis of the statistical sets of dimeric complexes
shown in Figure~XXX
confirmed that in the great majority of cases the 
OEP technique gives reasonably accurate results with respect
to the parent model with relative errors less than 10\%,
unless systems are charged.
%
{
\renewcommand{\arraystretch}{1.4}
\begin{table}[h]
\caption[Accuracy of approximate CT/HF0 energy methods across wide range of bi\hyp{}molecular complexes]
{{\bf Accuracy of approximate CT/HF0 energy methods across wide range of bi\hyp{}molecular complexes\footnotemark[1]}
}
\label{t:2}
\begin{ruledtabular}
\begin{tabular}{lclcccccccc}
         &&       && \multicolumn{7}{c}{RMSE (kcal/mol) } \\
\cline{4-11}
\multicolumn{3}{c}{Database}
   && OL\footnotemark[2]  
                  && \multicolumn{3}{c}{OEP\footnotemark[3]}  
                  && EFP2\footnotemark[4] \\
\cline{1-3}
\cline{4-5}
\cline{6-9}
\cline{10-11}
NCB31\footnotemark[5] 
      &&  HB6/04  && 1.38 && 1.36 && 0.37 && 2.45 \\ % 
      &&  DI6/04  && 0.35 && 0.66 && 0.22 && 0.44 \\ % 
      &&  CT7/04  && 0.98 && 2.82 && 0.71 && 4.06 \\ % 
      &&  WI7/04  && 0.01 && 0.09 && 0.05 && 0.02 \\ % 
      &&  PPS5/05 && 0.07 && 1.31 && 0.79 && 0.60 \\ % 
      &&  Total   && 0.83 && 1.69 && 0.53 && 2.39 \\ % 
\cline{1-3}
\cline{4-5}
\cline{6-9}
\cline{10-11}

BBI\footnotemark[6]   
      &&  Subset\footnotemark[7]
                  && 0.26 && 0.56 && 0.13* && 0.12 \\ %
\end{tabular}
\end{ruledtabular}
%
\footnotetext[1]{Validated against Eq.~\eqref{e:ct-pthf-ref}.}
\footnotetext[2]{Otto and Ladik's expression from Eq.~(4) in Ref.~\cite{Otto.Ladik.ChemPhys.1975}}
\footnotetext[3]{This work, Eq.~\eqref{e:ect-oep.final-scaled} 
with $C=1.00$ (left column) and $C=1.56$ (right columm).
GDF(1)/aug-cc-pVDZ-jkfit scheme was used for the extended density fitting of group (i) OEP's.}
\footnotetext[4]{Ref.~\cite{Li.Gordon.Jensen.JCP.2006}, Eq.~\eqref{e:u-efp2-ct}.}
\footnotetext[5]{Ref.~\cite{Zhao.Truhlar.JCTC.2005,Zhao.Schultz.Truhlar.JCTC.2006,Zhao.Schultz.Truhlar.JCP.2005,Zhao.Schultz.Truhlar.JCTC.2006}}
\footnotetext[6]{Ref.~\cite{Burns.Faver.Zheng.Marshall.Smith.Vanommeslaeghe.MacKerell.Merz.Sherrill.JCP.2017}}
\footnotetext[7]{100 backbone\hyp{}sidechains complexes were randomly selected.}
%
\end{table}
}
%


In the case of water dimer and methanol-water complex, EFP2 and PT/HF estimations
coincide with the OEP model. However, in the presence of ions, 
the deviation of the OEP model from the PT/HF energy 
become significant, in contrast to the EFP2 model, which gives very good estimates
of the PT/HF energy in mostly all cases.
Naturally, the accuracy of the Otto\hyp{}Ladik model limits the absolute accuracy
of the OEP model, which is manifested in the ammonium nitrate system
in Figure~\ref{f:fig-2}(c) or the problems with SOA. 
In order to improve the performance for ionic systems,
further studies are necessary, that will modify the original formulation
of Otto and Ladik and SOA treatment. Nevertheless, except from the ionic systems,
it is clear that the level of accuracy of the EFP2 and OEP models are rather comparable
(Figure~XX) across a wide range of various interacting complexes including 
systems with H-boding, dominated by dipole-dipole or dispersion interactions or 
exhibiting substantial CT.
%
\begin{figure}[h]
\includegraphics[width=0.46\textwidth]{fig-2.pdf}
\caption{\label{f:fig-2} {\bf Asymptotic dependence of the charge transfer energy
in the CT/HF0 formulation for selected bi\hyp{}molecular complexes.} 
The charge transfer energy estimates are plotted for 
(a) water dimer, 
(b) water\hyp{}ammonium complex, and 
(c) ammonium\hyp{}nitrate complex,
where one molecule has been translated by $R$ from the starting geometry
optimized at HF/6-31+G(d,p) level,
along the vector specified in the insets.
The counterpoise\hyp{}corrected total interaction energy
is also shown for comparison in light grey color in this figure.
Interaction energies were obtained at the HF/6-311++G(2df,2pd) level of theory
with the single GDF scheme and aug-cc-pVQZ-jkfit auxiliary basis set.
} 
\end{figure}
%

%
\begin{figure*}[h]
\includegraphics[width=0.9\textwidth]{fig-3.pdf}
\caption{\label{f:fig-3} {\bf Performance of the OEP and EFP2 methods for the CT/HF0 charge transfer interaction energy
in small bi\hyp{}molecular neutral complexes.}
(a) accuracy of the ERI elimination technique; 
(b) accuracy of the OEP and EFP2 estimates of the CT energy with respect to the
CT/HF0 estimate. 
The structures of bi\hyp{}molecular complexes
were taken from the NCB31 database developed by the Truhlar's group:
the HB6/04 hydrogen bonding database 
(red),\cite{Zhao.Truhlar.JCTC.2005,Zhao.Schultz.Truhlar.JCTC.2006,Zhao.Schultz.Truhlar.JCP.2005}
the DI6/04 dipoleinteraction database 
(green),\cite{Zhao.Truhlar.JCTC.2005,Zhao.Schultz.Truhlar.JCTC.2006,Zhao.Schultz.Truhlar.JCP.2005}
the CT7/04 charge-transfer complex database 
(blue),\cite{Zhao.Truhlar.JCTC.2005,Zhao.Schultz.Truhlar.JCTC.2006,Zhao.Schultz.Truhlar.JCP.2005}
the WI7/05 weak interaction database 
(yellow),\cite{Zhao.Schultz.Truhlar.JCTC.2006,Zhao.Schultz.Truhlar.JCP.2005,Zhao.Truhlar.JPCA.2005}
and PPS5/05 the $\pi$-$\pi$ stacking database 
(black).\cite{Zhao.Schultz.Truhlar.JCTC.2006,Zhao.Schultz.Truhlar.JCP.2005,Zhao.Truhlar.JPCA.2005}
6-311++G** basis set was used for the CT energy calculations
and the single GDF scheme with the aug-cc-pVDZ auxiliary basis set
for the OEP calculations.
} 
\end{figure*}
%

%
\begin{figure*}[h]
\includegraphics[width=0.9\textwidth]{fig-4.pdf}
\caption{\label{f:fig-4} {\bf Performance of the OEP and EFP2 methods for the CT/HF0 charge transfer interaction energy
in aminoacid pairs.}
(a) accuracy of the ERI elimination technique; 
(b) accuracy of the OEP and EFP2 estimates of the CT energy with respect to the
CT/HF0 estimate. 
The structures of 100 aminoacid pairs
were randomly selected from the BBI Bioo database
for backbone\hyp{}sidechain interactions.\cite{Burns.Faver.Zheng.Marshall.Smith.Vanommeslaeghe.MacKerell.Merz.Sherrill.JCP.2017}
6-31+G(d,p) basis set was used for the CT energy calculations
and the single GDF scheme with the aug-cc-pVDZ auxiliary basis set
for the OEP calculations.
} 
\end{figure*}
%





\subsection{\label{ss:5.2.cost}Reduction of computational costs}

The utmost goal of this work is to reduce the computational cost of
the CT PT/HF energy evaluation in the calculations involving effective fragment
potentials. The EFP2 CT expression has the computational cost
roughly proportional to $(10on^2 + 2n^3 + o^2n^2)v$, where the
$o$ and $n$ denote the number of occupied orbitals and the number of atomic basis functions,
respectively, whereas $v$ is the relative cost. On the other hand, OEP\hyp{}based expression
from Eq.~\eqref{e:ect-oep.final} has the cost of approximately $on(Q+N+o)$, where 
$Q$ and $N$ denote the number of auxiliary basis functions and the number of atoms,
respectively. 
%
{
\renewcommand{\arraystretch}{1.4}
\begin{table}[h]
\caption[Minimal auxiliary basis set optimized for OEP\hyp{}based CT/HF0 calculations.]
{{\bf}Minimal auxiliary basis set optimized for OEP\hyp{}based CT/HF0 calculations.\footnotemark[1]
}
\label{t:3}
\begin{ruledtabular}
\begin{tabular}{lldcd}
 AO's &  & \multicolumn{3}{c}{Exponents (a.u.)}\\
      &  & \text{Methanol}         && \text{Water}           \\
\cline{1-2}
\cline{3-5}
 H    &1s&   7.7369294534   &&   29.5837988322 \\
 C    &1s& 880.3654511045   &&                 \\
      &2s& 123.8276940826   &&                 \\
      &2p&  11.6748155072   &&                 \\
 O    &1s& 902.9798919021   && 1030.5721050297 \\
      &2s& 203.7584408153   &&  142.1022267153 \\
      &2p&  20.2442429692   &&   40.9175702474 \\
\end{tabular}
\end{ruledtabular}
%
\footnotetext[1]{Fitting performed according to Appendix.~\eqref{a:auxiliary-basis} assuming 6-311++G(d,p) 
and aug-cc-pVDZ-jkfit primary and test basis sets, respectively.}
%
\end{table}
}
%


In this section, computational cost is estimated from the formulas.
%In
%Table~\ref{t:oep-costs} 
%
%{
%\renewcommand{\arraystretch}{1.4}
%\begin{table}[b]
%\caption[Computational cost of the benchmark and OEP-based methods: calculation of coupling constant]
%{{\bf Computational cost of the benchmark and OEP-based methods\footnotemark[1]}
%}
%\label{t:oep-costs}
%\begin{ruledtabular}
%\begin{tabular}{lcccccc}
%Method             && Murrell et al. &&    EFP2        &&      OEP     \\ 
%	\cline{1-7}
%Group (i)         &&  &&        &&   $obQ$     \\
%Group (ii)        &&  &&        &&   $ob$      \\
%Group (iii)       &&  &&        &&   $ob(n+o)$     \\
%Total Cost        &&  && $10ob^2 + 2b^3 + o^2b^2$       &&   $ob(Q+n+o)$     \\
%\end{tabular}
%\end{ruledtabular}
%%
%\footnotetext[1]{Numbers of: $o$ - occupied molecular orbitals; $b$ - atomic basis functions; $n$ - atoms; 
%$Q$ - auxiliary basis functions. It was assumed that the number of virtual orbitals is equal to $b$.}
%%
%\end{table}
%}
%
{
\renewcommand{\arraystretch}{1.4}
\begin{table}[h]
\caption[Minimal auxiliary basis set optimized for OEP\hyp{}based CT/HF0 calculations.]
{{\bf}CPU timings in miliseconds of CT/HF0 single point energy calculations
for water-methanol complex at 6-311++G(d,p) primary basis set\footnotemark[1]
}
\label{t:4.oep-costs}
\begin{ruledtabular}
\begin{tabular}{llccc}
                      && Water-Methanol && Water dimer \\
\cline{3-5}
OL                    && 774    &&\\
EFP2                  &&  42.3  &&\\
OEP/aug-cc-pVQZ-jkfit &&   4.7  &&\\
OEP/aug-cc-pVTZ-jkfit &&   4.0  &&\\
OEP/aug-cc-pVDZ-jkfit &&   3.8  &&\\
OEP/6-311++G(d,p)     &&   3.0  &&\\
OEP/mini              &&   2.5  &&\\
\end{tabular}
\end{ruledtabular}
%
\footnotetext[1]{CPU: XXX. See the implementation details in Section~\ref{s:4.calculations} and Section~\ref{ss:5.2.cost}.}
%
\end{table}
}
%


%
It is clear that the cost of the OEP\hyp{}based equations is much lesser than the cost of EFP2 method,
and many orders of magnitude lesser than the original theory of Murrell et al.
%
\begin{figure}[h]
\includegraphics[width=0.46\textwidth]{fig-5.pdf}
\caption{\label{f:fig-5} {\bf Asymptotic dependence of the charge transfer energy
in the CT/HF0 formulation for methanol-warer complex with minimal OEP auxiliary basis.} 
Water molecule has been translated by $R$ from the starting geometry
optimized at HF/6-31+G(d,p) level,
along the vector specified in the insets.
The counterpoise\hyp{}corrected total interaction energy
is also shown for comparison in light grey color in this figure.
Interaction energies were obtained at the HF/6-311++G(d,p) level of theory.
In this figure, `OEP' denotes single GDF scheme with aug-cc-pVQZ-jkfit auxiliary basis set
whereas `OEP/mini` denotes double GDF scheme with the minimal auxiliary basis
developed here for water and methanol.
} 
\end{figure}
%



\section{\label{s:6.conclusions}Summary and a few concluding remarks}

In this work, the one\hyp{}electron effective potential operator technique
for eliminating electron repulsion integrals in the fragment\hyp{}based
theories of intermolecular interactions
was derived and applied to calculating the charge transfer energy
in condensed phases simulations. It was shown that in general case two types of OEP's
can be defined and worked out either through the density fitting or the distributed
multipole expansion. For the first group of OEP's, the density fitting was generalized
and two computational treatments of OEP's were developed: the single GDF scheme
for RI\hyp{}type auxiliary basis sets, as well as the double GDF scheme, for
essentially all other types of basis sets. The presented validation of the OEP technique
against the Otto\hyp{}Ladik CT/HF0 model as parent theory showed that in most cases
elimination of ERI's is quantitatively accurate, with few exceptions
where only qualitative accuracy was found. 
Finally, it was found that, while the proposed OEP\hyp{}based Otto\hyp{}Ladik
model is of comparable accuracy as the CT/HF0 formulation within the
state\hyp{}of\hyp{}the\hyp{}art EFP2 model, it significantly outperforms the latter
in terms of computational efficiency reaching speedups up to 30--40 times.
%Since EFP2 method is based on the PT/HF0 foundations
%with fragments defined in gas phase state,
%interaction energies without the CT contribution
%in this model
%are
%conceptually incomplete.
Therefore, it is believed that the OEP\hyp{}based
model can be incorporated within the EFP2 method, enabling
the full (CT\hyp{}including) EFP2 energy calculations and 
molecular dynamics simulations in large systems. However, further 
study is necessary and the following issues need to be carefully addressed:

\begin{acknowledgments}
This project is carried out under POLONEZ programme which has received funding from the European Union's
Horizon~2020 research and innovation programme under the Marie Sk{\l}odowska-Curie grant agreement 
No.~665778. This project is funded by National Science Centre, Poland 
(grant~no. 2016/23/P/ST4/01720) within the POLONEZ 3 fellowship.
We thank Professor Marcos Mandado from University of Vigo in Spain
for providing us with his benchmark calculations to validate our implementation
of the DDS method.
\end{acknowledgments}

%%
\appendix

\section{Optimized Auxiliary Basis Sets for OEP Applications\label{a:auxiliary-basis}}

To fit the auxiliary DF basis for the treatment of the overlap\hyp{}like
OEP matrix elements with the operator $\hat{v}_{\rm eff}$, 
the following objective function is minimized
%
\begin{equation} \label{e:a1-obj}
 Z[\{\xi\}] = \sum_{\alpha i} \left[ 
     \tBraKet{\alpha}{\hat{v}_{\rm eff}}{i} - 
     \sum_{\xi}^{\rm DF} V_{\xi i} S_{\alpha \xi} 
    \right]^2 \;,
\end{equation}
%
where $\{\xi\}$ is the auxiliary basis set to optimize, whereas $\{\alpha\}$
is the `test' basis set used to probe the accuracy of the density fitting.
The forms of the %Pauli and 
charge\hyp{}transfer DF matrices $\tBraKet{\alpha}{\hat{v}_{\rm eff}}{i}$
can be directly derived 
from Eq.~\eqref{e:v-oep.ct}
%from Eqs.~\eqref{e:v-oep.rep} and \eqref{e:v-oep.ct}, respectively, 
by expanding the MO's in terms of atomic basis functions. The working formulae
are given below:
%
\begin{subequations} \label{e:a1-v.oep}
 \begin{align}
   \tBraKet{\alpha}{\hat{v}_{\rm eff}^{\rm Rep}}{i}
     &= \sum_{x}^{\rm At} W_{\alpha i}^{(x)} \nonumber   \\ 
        + \sum_{\beta\gamma\delta} &
           \left\{ 
             2 C_{\beta i} D_{\gamma\delta} - C_{\gamma i} D_{\beta \delta}
           \right\}
           \BraKet{\alpha\beta}{\gamma\delta} \;,\\
   \tBraKet{\alpha}{\hat{v}_{\rm eff}^{\rm CT}}{n} 
     &= \sum_{x}^{\rm At} W_{\alpha n}^{(x)} \nonumber   \\
       + \sum_{\beta\gamma\delta} &
           \left\{
             2 C_{\beta n} D_{\gamma\delta} - C_{\gamma n} D_{\beta \delta}
           \right\}
           \BraKet{\alpha\beta}{\gamma\delta}
    \;.
 \end{align}
\end{subequations}
%
In the above equations, ${\bf C}$ is the LCAO\hyp{}MO matrix whereas ${\bf D}$
is the one\hyp{}particle density matrix in AO basis.

\section{Coulomb-like OEP via Cumulative Atomic Multipole Moments\label{a:oep-camm}}

Overlap\hyp{}like OEP's are always associated with the effective one\hyp{}particle density
(or bond\hyp{}order) 
matrices and the $\lambda$ parameter from Eq.~\eqref{e:oep-operator} being either 1 or 0. 
Therefore, one can use this fact to compute the effective distributed multipole
moments. In this work, the cumulative atomic multipole moments (CAMM)
of Sokalski and Poirier with Mulliken partitioning of the AO space
were chosen because of their simplicity.
One of examples
of such OEP\hyp{}based models reported already in the literature is
the transition cumulative atomic multipole moments (TrCAMM) model
for estimation of the excitation energy transfer (EET) couplings in the F{\"o}rster
limit\cite{Blasiak.Maj.Cho.Gora.JCTC.2015}, 
or the vibrational solvatochromic distributed multipole moments
(SolCAMM) for the determination of the vibrational frequency shifts
of spatially localized IR probes.\cite{Blasiak.Lee.Cho.JCP.2013}
In general, having the OED and $\lambda$, the effective cumulative atomic charges
and dipole moments are given by
%
\begin{subequations} \label{e:a1-v.oep-camm}
 \begin{align}
  q_x^{\rm eff} &= \lambda Z_x - 
       \sum_{\alpha\in x}\sum_{\beta} 
        P_{\alpha\beta}^{\rm eff} \BraKet{\alpha}{\beta} \;, \\
  {\BM\upmu}_x^{\rm eff} &= 
       \sum_{\alpha\in x}\sum_{\beta} 
        P_{\alpha\beta}^{\rm eff}
   \left\{ 
    \BraKet{\alpha}{\beta} {\bf R}_x - \tBraKet{\alpha}{\bf r}{\beta} 
   \right\}
   \;,
 \end{align}
\end{subequations}
%
where ${\bf R}_x$ is the position vector of the $x$-th nucleus.
Note that $P_{\alpha\beta}^{\rm eff}$ can refer to the particular electron
spin, or their sum as a bond order matrix as well.
Equations for the effective distributed quadrupoles, octupoles and hexadecapoles
can be easily obtained by analogy from Ref.~\cite{Blasiak.Maj.Cho.Gora.JCTC.2015}


%
%\section{\label{a:mcmurchie-davidson} McMurchie-Davidson Method for Asymmetric Electron Repulsion Integrals}
%
%Evaluation of integrals $(ijk\vert l)$,
%that are necessary for the generalized density fitting of OEP's,
%can be easily carried out by re\hyp{}expressing the
%unnormalized product of three primitive Gaussian\hyp{}type (GTO) functions,
%%
%\begin{equation} \label{e:1}
%[ijk] \equiv \phi_i({\bf r}) \phi_j({\bf r}) \phi_k({\bf r}) \;,
%\end{equation}
%%
%in terms of Hermite functions. It can be shown that
%%
%\begin{multline} \label{e:2}
%   [ijk] = E_{ijk} \sum_{N=0}^{n_1+n_2+n_3} \sum_{L=0}^{l_1+l_2+l+3} \sum_{M=0}^{m_1+m_2+m_3} 
%	\\
%          d_N^{n_1n_2n_3} d_L^{l_1l_2l_3} d_M^{m_1m_2m_3}
%          \Lambda_N(x_R)\Lambda_L(y_R)\Lambda_M(z_R)e^{-\alpha_Rr_R^2}
%\end{multline}
%%
%in which the McMurchie-Davidson $d3$ coefficients are given by the following recurrence relationships
%%
% \begin{align} \label{e:3}
%  d_N^{n_1+1,n_2,n_3} &= \frac{1}{2\alpha_R} d_{N-1}^{n_1n_2n_3} 
%                             + \vert {\bf R} - {\bf A}\vert_x d_N^{n_1n_2n_3} \nonumber \\ 
%			    & \qquad\qquad + (N+1) d_{N+1}^{n_1n_2n_3} \\
%  d_N^{n_1,n_2+1,n_3} &= \frac{1}{2\alpha_R} d_{N-1}^{n_1n_2n_3} 
%                             + \vert {\bf R} - {\bf B}\vert_x d_N^{n_1n_2n_3} \nonumber \\
%			    & \qquad\qquad + (N+1) d_{N+1}^{n_1n_2n_3} \\
%  d_N^{n_1,n_2,n_3+1} &= \frac{1}{2\alpha_R} d_{N-1}^{n_1n_2n_3} 
%                             + \vert {\bf R} - {\bf C}\vert_x d_N^{n_1n_2n_3} \nonumber \\
%			    & \qquad\qquad + (N+1) d_{N+1}^{n_1n_2n_3} 
%\end{align}
%%
%with $d_0^{000} = 1$.
%In Eq.~\eqref{e:1},
%$\phi_i({\bf r})$ is given by
%%
%\begin{equation}
%\phi_i({\bf r}) \equiv x_A^{n_1} y_A^{l_1} z_A^{m_1} e^{-\alpha_1r_A^2}
%\end{equation}
%%
%where 
%${\bf r}_A \equiv {\bf r} - {\bf A}$,
%${\bf A}$ is the centre of the GTO, $\alpha_1$ its exponent, whereas $n_1,l_1,m_1$
%the Cartesian angular momenta, with the total angular momentum $\theta_1 = n_1+l_1+m_1$.
%
%It can be easily shown that the multiplicative constant $E_{ijk}$ is given by
%%
%\begin{multline}
%  E_{ijk}(\alpha_1,\alpha_2,\alpha_3)  = \exp{\left[-\frac{\alpha_1\alpha_2}
%                                        {\alpha_1+\alpha_2}\vert {\bf A}-{\bf B}\vert^2\right]} \\ \times
%                                         \exp{\left[-\frac{(\alpha_1+\alpha_2)\alpha_3}
%                                        {\alpha_1+\alpha_2+\alpha_3}
%                                         \vert {\bf P}-{\bf C}\vert^2\right]} 
%\end{multline}
%%

% -----------------------
\bibliography{references}
% -----------------------

\end{document}
